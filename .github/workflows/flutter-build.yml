name: Flutter Build (Android & iOS)

on:
  push:
    branches: [ "main" ] # Ana dala kod yÃ¼klediÄŸinde Ã§alÄ±ÅŸÄ±r
  workflow_dispatch:      # Ä°stediÄŸin zaman elle tetiklemek iÃ§in

jobs:
  # ==================================================
  # ğŸ¤– GÃ–REV 1: ANDROID APK (Android Cihazlar Ä°Ã§in)
  # ==================================================
  build-android:
    name: Build Android APK
    runs-on: ubuntu-latest
    
    steps:
      - name: KodlarÄ± Ã‡ek
        uses: actions/checkout@v4

      - name: Java Kurulumu
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Flutter Kurulumu
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          
      - name: BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle
        run: flutter pub get

      - name: APK OluÅŸtur (Debug)
        run: flutter build apk --debug

      - name: Sonucu Kaydet (Artifact)
        uses: actions/upload-artifact@v4
        with:
          name: android-apk
          path: build/app/outputs/flutter-apk/app-debug.apk

  # ==================================================
  # ğŸ GÃ–REV 2: iOS IPA (Sideloadly ile YÃ¼klemek Ä°Ã§in)
  # ==================================================
  build-ios-unsigned:
    name: Build Unsigned IPA
    runs-on: macos-latest # DÄ°KKAT: Kotandan 10 kat hÄ±zlÄ± dÃ¼ÅŸer!
    
    steps:
      - name: KodlarÄ± Ã‡ek
        uses: actions/checkout@v4

      - name: Flutter Kurulumu
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'

      - name: BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle
        run: flutter pub get

      # 1. iOS UygulamasÄ±nÄ± Ä°MZASIZ olarak derle
      - name: Build iOS (No Codesign)
        run: flutter build ios --release --no-codesign

      # 2. .app klasÃ¶rÃ¼nÃ¼ .ipa formatÄ±na Ã§evir (Sideloadly iÃ§in ÅŸart)
      - name: Paketle (Convert to IPA)
        run: |
          mkdir Payload
          mv build/ios/iphoneos/Runner.app Payload/
          zip -r release_app.ipa Payload

      # 3. Sonucu Kaydet (Artifact)
      - name: Sonucu Kaydet (Artifact)
        uses: actions/upload-artifact@v4
        with:
          name: ios-unsigned-ipa
          path: release_app.ipa
